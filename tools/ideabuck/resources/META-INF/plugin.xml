<idea-plugin>
  <id>intellij.buck.plugin</id>
  <name>Buck for IDEA</name>
  <version>3.7.4-SNAPSHOT</version>
  <category>Build</category>
  <vendor email="fb-plugins@fb.com" url="www.facebook.com">Facebook, Inc.</vendor>

  <description><![CDATA[
    An IntelliJ plugin for <a href="https://buck.build">the Buck build system.</a>
  ]]></description>

  <change-notes><![CDATA[
<h3>3.7.4</h3>
<ul>
</ul>
<h3>3.7.3</h3>
<ul>
  <li>Fixes to make triggering buck from IntelliJ more consistent with
  invoking it from the command-line.</li>
  <li>Improved cell discovery in prefs.</li>
</ul>
</h3>
<h3>3.7.2</h3>
<ul>
  <li>Make grammar fully Starlark-compatible.</li>
  <li>Support reference navigation for identifiers in Starlark files.</li>
  <li>Support folding of various multi-line Starlark elements (function definitions,
      collections/comprehensions, etc.).</li>
  <li>Support structure view.</li>
</ul>
<h3>3.7.1</h3>
<ul>
  <li>Rebuild for changes in buck core re: test results.</li>
</ul>
<h3>3.7</h3>
<ul>
  <li>Add editor support for <code>.buckconfig</code> files, including
      <code>.buckconfig.local</code> and <code>*.bcfg</code> files.</li>
</ul>
<h3>3.6.1</h3>
<ul>
  <li>Add LiveTemplates support for Buck files and added some starter templates.</li>
  <li>Improved support for symbols imported via <code>load()</code>.</li>
</ul>
<h3>3.5.5</h3>
<ul>
  <li>Misc editor improvements for symbols loaded from extension files
      and colorization of target patterns.</li>
  <li>Migrate project-level settings for cells and executables from
      <code>.idea/ideabuck.xml<code> to <code>.idea/ideabuck/cells</code>
      and <code>.idea/ideabuck/executables.xml</code>, respectively,
      to allow those preferences to be independently committed or ignored
      in source control.</li>
  <li>Add preferences for <code>buildifier</code> and <code>buildozer</code>
      executables.</li>
</ul>
<h3>3.5.4</h3>
<ul>
  <li>Don't expand visibility in "autodeps" quick fix, but provide an error message
      with hyperlinks to make it easier for the user to do so.</li>
  <li>Moved the link for running tests with buck into the same hierarchical menu as
      the other test-running actions.</li>
  <li>Support for running JUnit3-style tests from the gutter.</li>
</ul>
<h3>3.5.3</h3>
<ul>
  <li>Convert "autodeps" feature to quick fix.</li>
  <li>Improved syntax parsing, highlighting, autocompletion, and click-through navigation.</li>
</ul>
<h3>3.5.2</h3>
<ul>
  <li>Move "Go to Buck file" action to Navigate menu and "Go To" popup menu.</li>
  <li>Show warning about missing Buck server as a balloon.</li>
  <li>Add project-level settings, stored in <code>.idea/ideabuck.xml</code></li>
  <li>Add limited support for cross-cell navigation in the editor.</li>
  <li>Improved click-through navigation in the buck editor</li>
</ul>

<h3>3.4</h3>
<ul>
  <li>Enable Layout Preview in Android projects generated by <code>buck project</code>.</li>
  <li>Support Skylark <code>glob</code> API (<code>exclude</code> attribute).</li>
  <li>Auto-complete <code>load</code> functions.</li>
  <li>Add limited support for detecting missing extension files referenced in <code>load</code>
  function. Currently only targets from the same cell are checked.</li>
  <li>Add limited <code>load</code> function target navigation. Currently only targets from the
  same cell are supported.</li>
</ul>

<h3>3.3</h3>
<ul>
  <li>"Optimize Imports" now removes duplicate dependencies.</li>
  <li>The paste code will not transform text if within a non-empty string.</li>
</ul>

<h3>3.2</h3>
<ul>
  <li>Fix paste bugs; add unit tests so paste doesn't break again.</li>
  <li>Move <tt>adb</tt>/<tt>buck</tt> configuration checks to point of use, so you no longer get
   Fatal Errors on opening IJ if you don't have <tt>adb</tt> installed.</li>
</ul>

<h3>3.1</h3>
<ul>
  <li>Detect new package creation, and mark it as a source folder.</li>
  <li>Remove the default folding of large arrays.</li>
</ul>

<h3>3.0</h3>
<ul>
  <li>Make plugin compatible with IntelliJ 2017.1.</li>
</ul>

<h3>2.9</h3>
<ul>
  <li>Add an ability to run tests from editor.</li>
  <li>Find adb based on ANDROID_SDK environment variable.</li>
  <li>Fold BUCK files.</li>
</ul>

<h3>2.8</h3>
<ul>
  <li>Detect resource creation in a Project View's <tt>/res</tt> directory,
    and moves the new file to an Android resource module.</li>
</ul>

<h3>2.7.8</h3>
<ul>
  <li>Fixed issues with Buck files showing syntax errors when using
    the glob function.</li>
</ul>

<h3>2.7.7</h3>
<ul>
  <li>Fix a bug with buck command never finishes. This solves the problem
    with not showing targets in "Choose Buck Target" pop-up.</li>
  <li>Use buck config to determine Buck file name (default is BUCK).</li>
</ul>

<h3>2.7.6</h3>
<ul>
  <li>Change pasting formatting to have double-quotes and four-space
    indents.</li>
</ul>

<h3>2.7.5</h3>
<ul>
  <li>Fix go-to-definition to recognize both single- and double-quoted
    strings.</li>
  <li>Fix how the icon gets initialized for the buck tool window.</li>
</ul>

<h3>2.7.4</h3>
<ul>
  <li>Added support for pasting multiple targets in a Buck file.</li>
  <li>Fixed issues with whitespace when pasting target(s) in a
    Buck file.</li>
</ul>

<h3>2.7.3</h3>
<ul>
  <li>Removed restriction on IDEA version.</li>
  <li>Added test run configuration.</li>
</ul>

<h3>2.7.2</h3>
<ul>
  <li>Fixed a bug with NullPointerException in BuckEventsQueue.</li>
  <li>Fixed multiple edge cases with autodeps logic.</li>
</ul>

<h3>2.7.1</h3>
<ul>
  <li>Updated upper-bound of plugin to 2016.2.</li>
</ul>

<h3>2.7.0</h3>
<ul>
  <li>Sending events for Buck plugin IntelliJ actions.</li>
  <li>Added adb select path to Tools.</li>
</ul>

<h3>2.6</h3>
<ul>
  <li>Improved server connect/disconnect.</li>
  <li>Moved actions from the UI thread.</li>
  <li>Fixed some compatibility issues.</li>
</ul>

<h3>2.5</h3>
<ul>
  <li>Updated buck icons.</li>
  <li>Made all existing paths in a Buck file clickable.</li>
  <li>Improved grammar.</li>
  <li>Show popup on how to enable the toolbar.</li>
  <li>Disable choose target if indexing not over.</li>
</ul>

<h3>2.4</h3>
<ul>
  <li>Added the plugin to the toolbar.</li>
  <li>Show successful/failed notification on action finished.</li>
  <li>Automatically find buck executable.</li>
  <li>Added install debugging.</li>
  <li>Minor bug fixes.</li>
</ul>

<h3>2.3</h3>
<ul>
  <li>Updated with the new buck API.</li>
  <li>Fixed old commands to work with Buck.</li>
</ul>

<h3>2.2</h3>
<ul>
  <li>Fetch build status via websocket.</li>
  <li>Publish build status notifications.</li>
</ul>

<h3>1.1</h3>
<ul>
  <li>Formatter for buck file.</li>
  <li>Buck dependencies sorter.</li>
  <li>Annotator for wrong buck dependency target.</li>
  <li>Line commenter.</li>
</ul>
    ]]>
  </change-notes>

  <!-- please see https://confluence.jetbrains.com/display/IDEADEV/Build+Number+Ranges for description -->
  <idea-version since-build="172.1294"/>

  <depends>com.intellij.modules.platform</depends>
  <depends>com.intellij.modules.lang</depends>

  <depends optional="true">org.jetbrains.android</depends>

  <extensions defaultExtensionNs="com.intellij">
    <fileTypeFactory implementation="com.facebook.buck.intellij.ideabuck.lang.BuckFileTypeFactory"/>
    <fileTypeFactory implementation="com.facebook.buck.intellij.ideabuck.lang.BcfgFileTypeFactory"/>
    <lang.parserDefinition
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.lang.BuckParserDefinition"/>
    <lang.parserDefinition
      language="Buckconfig"
      implementationClass="com.facebook.buck.intellij.ideabuck.lang.BcfgParserDefinition"/>
    <lang.syntaxHighlighterFactory
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.highlight.BuckSyntaxHighlighterFactory"/>
    <lang.syntaxHighlighterFactory
      language="Buckconfig"
      implementationClass="com.facebook.buck.intellij.ideabuck.highlight.BcfgSyntaxHighlighterFactory"/>
    <lang.importOptimizer
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.format.BuckImportOptimizer"/>
    <lang.foldingBuilder
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.folding.BuckFoldingBuilder"/>
    <lang.foldingBuilder language="Buckconfig"
      implementationClass="com.facebook.buck.intellij.ideabuck.folding.BcfgFoldingBuilder"/>
    <codeInsight.unresolvedReferenceQuickFixProvider
      implementation="com.facebook.buck.intellij.ideabuck.autodeps.BuckAutoDepsQuickFixProvider"/>
    <completion.contributor
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.completion.BuckCompletionContributor"/>
    <completion.contributor
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.completion.BuckTargetCompletionContributor"/>
    <codeStyleSettingsProvider
      implementation="com.facebook.buck.intellij.ideabuck.config.BuckCodeStyleSettingsProvider"/>
    <langCodeStyleSettingsProvider
      implementation="com.facebook.buck.intellij.ideabuck.format.BuckLanguageCodeStyleSettingsProvider"/>
    <gotoDeclarationHandler
      implementation="com.facebook.buck.intellij.ideabuck.navigation.BuckGotoProvider"
      order="FIRST"/>
    <gotoDeclarationHandler
      implementation="com.facebook.buck.intellij.ideabuck.navigation.BcfgGotoFileProvider"
      language="Buckconfig"/>
    <annotator language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.annotator.BuckAnnotator"/>
    <annotator language="Buckconfig"
      implementationClass="com.facebook.buck.intellij.ideabuck.annotator.BcfgAnnotator"/>
    <colorSettingsPage
      implementation="com.facebook.buck.intellij.ideabuck.config.BuckColorSettingsPage"/>
    <colorSettingsPage
      implementation="com.facebook.buck.intellij.ideabuck.config.BcfgColorSettingsPage"/>
    <lang.commenter language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.commenter.BuckCommenter"/>
    <lang.commenter language="Buckconfig"
      implementationClass="com.facebook.buck.intellij.ideabuck.commenter.BcfgCommenter"/>
    <lang.braceMatcher
      language="Buck"
      implementationClass="com.facebook.buck.intellij.ideabuck.format.BuckBraceMatcher"/>
    <lang.refactoringSupport language="Buck" implementationClass="com.facebook.buck.intellij.ideabuck.lang.BuckIdentifierRefactoringSupportProvider"/>
    <quoteHandler
      fileType="Buck"
      className="com.facebook.buck.intellij.ideabuck.format.BuckQuoteHandler"/>
    <lang.psiStructureViewFactory language="Buck" implementationClass="com.facebook.buck.intellij.ideabuck.structure.BuckStructureViewFactory"/>
    <copyPastePreProcessor
      implementation="com.facebook.buck.intellij.ideabuck.format.BuckCopyPasteProcessor"/>
    <toolWindow
      id="Buck"
      anchor="bottom"
      icon="/icons/buck_tool_window_icon.png"
      factoryClass="com.facebook.buck.intellij.ideabuck.ui.BuckToolWindowFactory"/>
    <projectConfigurable
      groupId="tools"
      displayName="Buck"
      id="buck.settings"
      instance="com.facebook.buck.intellij.ideabuck.config.BuckSettingsConfigurable"/>
    <projectService
      serviceImplementation="com.facebook.buck.intellij.ideabuck.build.BuckBuildManager"/>
    <projectService
      serviceImplementation="com.facebook.buck.intellij.ideabuck.ui.BuckUIManager"/>
    <projectService
      serviceImplementation="com.facebook.buck.intellij.ideabuck.notification.BuckNotification"/>
    <configurationType
      implementation="com.facebook.buck.intellij.ideabuck.configurations.TestConfigurationType"/>
    <programRunner
      implementation="com.facebook.buck.intellij.ideabuck.configurations.TestProgramRunner"/>
    <psi.referenceContributor implementation="com.facebook.buck.intellij.ideabuck.lang.BuckIdentifierReferenceContributor"/>

    <runLineMarkerContributor language="JAVA"
      implementationClass="com.facebook.buck.intellij.ideabuck.actions.select.SelectedTestRunLineMarkerContributor"/>
    <additionalTextAttributes scheme="Default" file="colorSchemes/BuckDefault.xml"/>
    <additionalTextAttributes scheme="Darcula" file="colorSchemes/BuckDarcula.xml"/>

    <defaultLiveTemplatesProvider
      implementation="com.facebook.buck.intellij.ideabuck.completion.BuckLiveTemplatesProvider"/>
    <liveTemplateContext implementation="com.facebook.buck.intellij.ideabuck.completion.BuckCodeContexts$Generic"/>
    <liveTemplateContext implementation="com.facebook.buck.intellij.ideabuck.completion.BuckCodeContexts$Declaration"/>
    <liveTemplateContext implementation="com.facebook.buck.intellij.ideabuck.completion.BuckCodeContexts$InString"/>
    <liveTemplateContext implementation="com.facebook.buck.intellij.ideabuck.completion.BuckCodeContexts$NamedArgument"/>
    <liveTemplateContext implementation="com.facebook.buck.intellij.ideabuck.completion.BuckCodeContexts$SimpleExpression"/>
    <liveTemplateContext implementation="com.facebook.buck.intellij.ideabuck.completion.BuckCodeContexts$Statement"/>
  </extensions>

  <actions>
    <group id="buck.Menu">
      <action
        id="buck.GoToBuckFile"
        class="com.facebook.buck.intellij.ideabuck.actions.GoToBuckFile"
        text="Buck file"
        description="Go to Buck file for this source file.">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift P"/>
      </action>
      <add-to-group anchor="first" group-id="EditorPopupMenu.GoTo"/>
      <add-to-group group-id="GoToMenu" anchor="after" relative-to-action="GoToCodeGroup"/>
    </group>

    <group id="buck.ToolbarActions">
      <action
        id="buck.GoToBuckFileToolbarAction"
        class="com.facebook.buck.intellij.ideabuck.actions.GoToBuckFile"
        text="Go to Buck file"
        icon="/icons/actions/GoTo.png"
        description="Go to Buck file for this source file.">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift P"/>
      </action>
      <add-to-group anchor="last" group-id="MainToolBar"/>
    </group>

    <group id="buck.BuildGroup">
      <separator></separator>
      <action class="com.facebook.buck.intellij.ideabuck.actions.ChooseTargetAction"
        id="buck.ChooseTarget">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift J"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckBuildAction" id="buck.Build">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift S"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckStopAction" id="buck.Stop" />
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckTestAction" id="buck.Test">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift Y"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckInstallAction"
        id="buck.Install">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift X"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckInstallDebugAction"
        id="buck.InstallDebug">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift D"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckUninstallAction"
        id="buck.Uninstall">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift M"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckProjectGenerationAction"
        id="buck.ProjectGeneration">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift B"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.BuckKillAction" id="buck.Kill">
        <keyboard-shortcut keymap="$default" first-keystroke="ctrl shift L"/>
      </action>
      <action class="com.facebook.buck.intellij.ideabuck.actions.ScrollToEndAction" id="buck.ScrollToEnd" />
      <action class="com.facebook.buck.intellij.ideabuck.actions.ClearTreeViewPanelAction" id="buck.Clear" />
      <add-to-group anchor="last" group-id="MainToolBar"/>
    </group>

    <group>
      <action class="com.facebook.buck.intellij.ideabuck.actions.select.BuckTestAtCursorAction$Run" id="buck.RunTestAtCursor"/>
      <action class="com.facebook.buck.intellij.ideabuck.actions.select.BuckTestAtCursorAction$Debug" id="buck.DebugTestAtCursor"/>
      <add-to-group anchor="last" group-id="RunContextGroup"/>
    </group>

  </actions>

  <project-components>
    <component>
      <implementation-class>com.facebook.buck.intellij.ideabuck.config.BuckModule
      </implementation-class>
      <loadForDefaultProject/>
    </component>
    <component>
      <implementation-class>
        com.facebook.buck.intellij.ideabuck.util.BuckCellFinder
      </implementation-class>
    </component>
    <component>
      <implementation-class>
        com.facebook.buck.intellij.ideabuck.config.BuckCellSettingsProvider
      </implementation-class>
    </component>
    <component>
      <implementation-class>
        com.facebook.buck.intellij.ideabuck.config.BuckExecutableSettingsProvider
      </implementation-class>
    </component>
    <component>
      <implementation-class>
        com.facebook.buck.intellij.ideabuck.config.BuckProjectSettingsProvider
      </implementation-class>
    </component>

    <!--
      Components in the package com.facebook.buck.intellij.ideabuck.api have
      stable APIs that are intended for use by other plugins.
     -->
    <component>
      <interface-class>com.facebook.buck.intellij.ideabuck.api.BuckCellManager</interface-class>
      <implementation-class>com.facebook.buck.intellij.ideabuck.impl.BuckCellManagerImpl</implementation-class>
    </component>
    <component>
      <interface-class>com.facebook.buck.intellij.ideabuck.api.BuckTargetLocator</interface-class>
      <implementation-class>com.facebook.buck.intellij.ideabuck.impl.BuckTargetLocatorImpl</implementation-class>
    </component>
  </project-components>
</idea-plugin>
